<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
 <title>CFIBER</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="initial-scale=1.0, target-densitydpi=device-dpi" />
<meta name="viewport" content="initial-scale=1.0, width=device-height">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" type="text/css" href="css/normalize.css">
  <link rel="stylesheet" type="text/css" href="css/framework.css">
  <link rel="stylesheet" type="text/css" href="css/washington.css">
  
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

  <script src="js/webfont.js"></script>
  <script>
    WebFont.load({
      google: {
        families: ["Montserrat:400,700"]
      }
    });
  </script>
  <script type="text/javascript" src="js/modernizr.js"></script>
  <link rel="shortcut icon" type="image/x-icon" href="images/logoStandford32.ico">
  <link rel="apple-touch-icon" href="images/logoStandford32.ico">

  <link href="css/ionicons.min.css" rel="stylesheet" type="text/css" />
  
  
<style type="text/css">

	
	input {
		padding: .5em;
		margin: .5em;
	}
	select {
		padding: .5em;
		margin: .5em;
	}
	
	#signatureparent {
		color:darkblue;
		//background-color:#03EAF4;
		/*max-width:600px;*/
		padding:20px;
	}
	
	/*This is the div within which the signature canvas is fitted*/
	#signature {
		border: 2px dotted black;
		background-color:lightgrey;
	}

	/* Drawing the 'gripper' for touch-enabled devices */ 
	html.touch #content {
		float:left;
		width:92%;
	}
	html.touch #scrollgrabber {
		float:right;
		width:4%;
		margin-right:2%;
		background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAFCAAAAACh79lDAAAAAXNSR0IArs4c6QAAABJJREFUCB1jmMmQxjCT4T/DfwAPLgOXlrt3IwAAAABJRU5ErkJggg==)
	}
	html.borderradius #scrollgrabber {
		border-radius: 1em;
	}
	 
</style>
</head>
<body>
<section class="w-section mobile-wrapper">
<div class="page-content" id="main-stack">
    <div class="w-nav navbar" data-collapse="all" data-animation="over-left" data-duration="400" data-contain="1" data-no-scroll="1" data-easing="ease-out-quint"> 
	<div class="w-container">
          <nav class="w-nav-menu nav-menu" role="navigation">
            <div class="nav-menu-header">
              <div class="logo">Cfibernet</div>
              <div class="slogan">All you need is here.</div>
            </div>
            <a class="w-clearfix w-inline-block nav-menu-link" href="index.html" data-load="1">
              <div class="icon-list-menu">
                <div class="icon ion-ios-home-outline"></div>
              </div>
              <div class="nav-menu-titles">Splash Screen</div>
            </a>
            <a class="w-clearfix w-inline-block nav-menu-link" id="logout" data-load="1">
              <div class="icon-list-menu">
                <div class="icon ion-ios-download-outline"></div>
              </div>
              <div class="nav-menu-titles">Logout</div>
            </a>           
            <a class="w-clearfix w-inline-block nav-menu-link" href="about-us.html" data-load="1">
              <div class="icon-list-menu">
                <div class="icon ion-ios-person-outline"></div>
              </div>
              <div class="nav-menu-titles">About</div>
            </a>
            <a class="w-clearfix w-inline-block nav-menu-link" href="maps.html" data-load="1">
              <div class="icon-list-menu">
                <div class="icon ion-ios-location-outline"></div>
              </div>
              <div class="nav-menu-titles">Map</div>
            </a>
            <a class="w-clearfix w-inline-block nav-menu-link" href="javascript:void(0)" id="ticket" data-load="1">
              <div class="icon-list-menu">
                <div class="icon ion-ios-box-outline"></div>
              </div>
              <div class="nav-menu-titles">Tickets</div>
            </a>            
            <div class="separator-bottom"></div>
            <div class="separator-bottom"></div>
            <div class="separator-bottom"></div>
          </nav>
          <div class="wrapper-mask" data-ix="menu-mask"></div>
          <div class="navbar-title">signature</div>
          <div class="w-nav-button navbar-button left" id="menu-button" data-ix="hide-navbar-icons">
            <div class="navbar-button-icon home-icon">
              <div class="bar-home-icon"></div>
              <div class="bar-home-icon"></div>
              <div class="bar-home-icon"></div>
            </div>
          </div>
    </div>	
	</div>		
	
		<div class="body">   
			<div class="news-container item-new">
					<div>        
						<div class="grey-header">
							<h2 class="grey-heading-title">Ticket Updation</h2>
						</div>			
					</div>			
				
						
						<div class="separator-fields"></div>
						<div class="separator-fields"></div>
						<div class="separator-fields"></div>
						<div class="separator-fields"></div>
						
						
						
						<form  method="POST" id="updateform" name="updateform">						
						<div class="errormsg" ></div>
							<label class="label-form" for="email-field" style="font-size: 16px !important;">Signature:</label>
						
							<div id="signatureparent"><div id="signature"></div></div>
							<input type="hidden" name="ticketid" id="ticketid" value=""  class="ticketid">
							<input type="hidden" name="signature_update" id="signature_update" value=""  class="signature_update">
							
							<div class="separator-fields"></div>
							<div class="separator-fields"></div>
							<label class="label-form" for="email-field" style="font-size: 16px !important;">Code:</label>
							<div class="separator-fields"></div>
							<div class="separator-fields"></div>
							<input class="w-input input-form" id="codenumber" style="border: 2px dotted black;
		background-color:lightgrey;width:89% !important;margin-left: 19px !important;" type="text" name="codenumber" value="" placeholder="Enter Your code">
							<div class="separator-fields"></div>
							<div id="tools"></div>
								
								<!--div><p>Display Area:</p><div id="displayarea"></div></div-->
						
							<div id="scrollgrabber"></div>
							
			
					<div class="bottom-section padding">					
						<input id="submit" onclick="validationcheck()" readonly  style="cursor:pointer;" class="w-button action-button" value="SUBMIT">	
						  
						<input type="reset" id="reset" value="RESET" class="w-button action-button">
					</div>
				
					
					
					</form>
					
			</div>		
		</div>
	
</div>
 <div class="page-content loading-mask" id="new-stack">
      <div class="loading-icon">
        <div class="navbar-button-icon icon ion-load-d"></div>
      </div>
    </div>
    <div class="shadow-layer"></div>
</section>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/framework.js"></script>
<script type="text/javascript" src="js/jquery.session.js"></script>
<script src="js/jquery.validate.min.js" type="text/javascript"></script>
<script src="js/jquery.js"></script>
<script type="text/javascript">
jQuery.noConflict()	
</script>
<script>

(function($) {
	var topics = {};
	$.publish = function(topic, args) {
	    if (topics[topic]) {
	        var currentTopic = topics[topic],
	        args = args || {};
	
	        for (var i = 0, j = currentTopic.length; i < j; i++) {
	            currentTopic[i].call($, args);
	        }
	    }
	};
	$.subscribe = function(topic, callback) {
	    if (!topics[topic]) {
	        topics[topic] = [];
	    }
	    topics[topic].push(callback);
	    return {
	        "topic": topic,
	        "callback": callback
	    };
	};
	$.unsubscribe = function(handle) {
	    var topic = handle.topic;
	    if (topics[topic]) {
	        var currentTopic = topics[topic];
	
	        for (var i = 0, j = currentTopic.length; i < j; i++) {
	            if (currentTopic[i] === handle.callback) {
	                currentTopic.splice(i, 1);
	            }
	        }
	    }
	};
})(jQuery);

</script>
<script src="js/jSignature.min.noconflict.js"></script>
<script>
(function($){

$(document).ready(function() {
	
	// This is the part where jSignature is initialized.
	var $sigdiv = $("#signature").jSignature({'UndoButton':true})
	
	// All the code below is just code driving the demo. 
	, $tools = $('#tools')
	, $extraarea = $('#displayarea')
	, pubsubprefix = 'jSignature.demo.'
	
	var export_plugins = $sigdiv.jSignature('listPlugins','export')
	, chops = ['<span style="visibility:hidden;"><b>Extract signature data as: </b></span><select id="mySelect" style="visibility:hidden;">','<option value="">(select export format)</option>']
	, name
		
		if (export_plugins.hasOwnProperty){
			//name = export_plugins[i]
				name="native"
			chops.push('<option value="' + name + '" id="test">' + name + '</option>')
		}

	chops.push('</select><span style="visibility:hidden;"><b> or: </b></span>')
	
	$(chops.join('')).bind('change', function(e){
		if (e.target.value !== ''){
			var data = $sigdiv.jSignature('getData', e.target.value)
			$.publish(pubsubprefix + 'formatchanged')
			if (typeof data === 'string'){
				$('textarea', $tools).val(data)
			} else if($.isArray(data) && data.length === 2){
				$('textarea', $tools).val(data.join(','))
				$.publish(pubsubprefix + data[0], data);
			} else {
				try {
					$('textarea', $tools).val(JSON.stringify(data))
				} catch (ex) {
					$('textarea', $tools).val('Not sure how to stringify this, likely binary, format.')
				}
			}
		}
	}).appendTo($tools)

	
 $('#reset').bind('click', function(e){
	$sigdiv.jSignature('reset');
	$('#displayarea').hide();
	})
	
		$.subscribe(pubsubprefix + 'image/png;base64', function(data) {
		var i = new Image()
		i.src = 'data:' + data[0] + ',' + data[1]
		$('<span><b>As you can see, one of the problems of "image" extraction (besides not working on some old Androids, elsewhere) is that it extracts A LOT OF DATA and includes all the decoration that is not part of the signature.</b></span>').appendTo($extraarea)
		$(i).appendTo($extraarea)
	});
	
//	$('<input type="submit" value="Submit" onclick="onDeviceReady();">').bind('click', function(e){
	//	$sigdiv.jSignature('submit')
	//}).appendTo($tools)
	
	$('<div><textarea style="width:100%;height:7em;visibility:hidden;" id="sign" name="sign" value="" ></textarea></div>').appendTo($tools)
	
//	if (Modernizr.touch){
	//	$('#scrollgrabber').height($('#content').height())		
	//}
	
	
	
})

})(jQuery)
</script>


<script type="text/javascript">
$(document).ready(function() {

var full_url = document.URL; 
var url_array = full_url.split('='); 
var last_segment = url_array[url_array.length-1]; 
//alert(last_segment);
 
 $("#ticketid").val(last_segment);

 $.session.set('username', last_segment);
 var sesionName = $.session.get('username');
 
 
 $("#ticket").click(function(){  
	window.location.href ='ticket.html?username=' + sesionName;	
 });
 
 $("#map").click(function(){  
	window.location.href ='maps.html?username=' + sesionName;
 }); 
 
 $("#about-us").click(function(){  
	window.location.href ='about-us.html?username=' + sesionName;
 });
 
$("#update").click(function(){  
	window.location.href ='about-us.html?username=' + sesionName;
 });
 	
	$("#logout").click(function(){
	
	var remove=$.session.remove(sesionName);
	//alert(remove);
	window.location='login.html';	
	
});



var full_url = document.URL; 
var url_array = full_url.split('='); 
var last_segment = url_array[url_array.length-1];  
//alert(last_segment);

});

function validationcheck() {   
   document.getElementById('mySelect').value = "native";
   jQuery('#mySelect').trigger('change');

			var myimage="[]";
			var sign= jQuery('#sign').val();			
			var codenumber= jQuery('#codenumber').val();
			
			
			
		if ((sign == myimage ) && (codenumber == "") ) {		
		    $(".errormsg").html('<div class="alert alert-danger"><a href="#" class="close" data-dismiss="alert"  style="width: 4%;" aria-label="close">&times;</a><strong>Error!</strong> Please Enter Your Signature and Code number. </div>');
		} 
		else if(codenumber == "") {			
			$(".errormsg").html('<div class="alert alert-danger"><a href="#" class="close" data-dismiss="alert"  style="width: 4%;" aria-label="close">&times;</a><strong>Error!</strong> Please Enter Your Code number. </div>');
		}
		
		else if(sign == myimage) {		 
			$(".errormsg").html('<div class="alert alert-danger"><a href="#" class="close" data-dismiss="alert"  style="width: 4%;" aria-label="close">&times;</a><strong>Error!</strong> Please Enter Your Signature. </div>');
		}
		else {
	
			 success();
		}
 }   
 
 function success(){
 
 var data=jQuery('#sign').val();
 var id=jQuery('#ticketid').val();

 var datas = new FormData($("form#updateform")[0]);
 
 var formURL = 'http://techsupport.cfnet.in/mobix/insertsign/';
 jQuery.ajax({ 
					type:'POST',
					url:formURL,			        
					crossDomain: true,
					cache: false,
				  //  data: "sign="+data+ "&id="+id,					
				    data: datas,					
					contentType: false,
					processData: false,
					async:false,
					success:function(response){
				
					$('#reset').trigger('click');
					
						if(response==1)
						{
							$(".errormsg").html('<div class="alert alert-success"><a href="#" class="close" data-dismiss="alert"  style="width: 4%;" aria-label="close">&times;</a><strong>Success!</strong> Successfully Inserted.</div>');
						}
						else if(response==2)
						{
							$(".errormsg").html('<div class="alert alert-danger"><a href="#" class="close" data-dismiss="alert"  style="width: 4%;" aria-label="close">&times;</a><strong>Error!</strong>Updation Failed.</div>');
						}
						else if(response==3)
						{
							$(".errormsg").html('<div class="alert alert-danger"><a href="#" class="close" data-dismiss="alert"  style="width: 4%;" aria-label="close">&times;</a><strong>Error!</strong>You have Some Problem.</div>');
						}
				}
		});
  
  }	
 </script>
</body>
</html>
